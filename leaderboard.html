<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Leaderboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #0f172a, #111827);
  color: #f3f4f6;
  margin: 0;
}

.container {
  max-width: 700px;
  margin: auto;
  padding: 60px 20px;
  text-align: center;
}

h1 {
  font-size: 38px;
  font-weight: 800;
  margin-bottom: 10px;
}

.subtitle {
  color: #9ca3af;
  margin-bottom: 40px;
}

.podium-entry {
  padding: 28px;
  margin: 18px 0;
  border-radius: 20px;
  font-size: 22px;
  font-weight: 700;
  transition: 0.3s;
}

.podium-1 {
  background: linear-gradient(90deg, #facc15, #fde047);
  color: black;
}

.podium-2 {
  background: linear-gradient(90deg, #e5e7eb, #d1d5db);
  color: black;
}

.podium-3 {
  background: linear-gradient(90deg, #d97706, #f59e0b);
  color: black;
}

.percent {
  display: block;
  font-size: 16px;
  margin-top: 8px;
  font-weight: 500;
}

.loading {
  font-size: 18px;
  margin-top: 40px;
  color: #9ca3af;
}

/* Mobile */
@media (max-width: 600px) {
  h1 { font-size: 28px; }
  .podium-entry { font-size: 18px; padding: 20px; }
}
</style>
</head>

<body>

<div class="container">
  <h1>Live Leaderboard</h1>
  <div class="subtitle">Most Popular Podium Predictions</div>

  <div id="podium">
    <div class="loading">Loading...</div>
  </div>
</div>

<script>

async function loadLeaderboard() {

    const podiumDiv = document.getElementById("podium");


  try {

    const response = await fetch("https://api.airtable.com/v0/appqinDjW4HCVjwQY/tblC0xM9xKI27YkXX", {
  method: "GET",
  headers: {
    "Authorization": "Bearer patndpbY9QOFEzASh.2e1e8e15b2ad636ccda008f09a20abc4419a639f2e36beea1497ccfb852f9afe"
  }
});


    const data = await response.json();
    const records = data.records || [];
    const total = records.length;

    if (total === 0) {
      podiumDiv.innerHTML = "<div class='loading'>No submissions yet.</div>";
      return;
    }

    let firstCounts = {};
    let secondCounts = {};
    let thirdCounts = {};

    records.forEach(record => {

      const ranking = record.fields["Ranking Order"];
      if (!ranking) return;

      const lines = ranking.split("\n");

      if (lines[0]) {
        const name = lines[0].replace("1. ", "").trim();
        firstCounts[name] = (firstCounts[name] || 0) + 1;
      }

      if (lines[1]) {
        const name = lines[1].replace("2. ", "").trim();
        secondCounts[name] = (secondCounts[name] || 0) + 1;
      }

      if (lines[2]) {
        const name = lines[2].replace("3. ", "").trim();
        thirdCounts[name] = (thirdCounts[name] || 0) + 1;
      }

    });

    function getTop(counts) {
      return Object.entries(counts)
        .sort((a, b) => b[1] - a[1])[0];
    }

    function percent(count) {
      return Math.round((count / total) * 100) + "%";
    }

    const top1 = getTop(firstCounts);
    const top2 = getTop(secondCounts);
    const top3 = getTop(thirdCounts);

    podiumDiv.innerHTML = `
      <div class="podium-entry podium-1">
        ðŸ¥‡ ${top1 ? top1[0] : "-"}
        <span class="percent">${top1 ? percent(top1[1]) + " picked 1st" : ""}</span>
      </div>

      <div class="podium-entry podium-2">
        ðŸ¥ˆ ${top2 ? top2[0] : "-"}
        <span class="percent">${top2 ? percent(top2[1]) + " picked 2nd" : ""}</span>
      </div>

      <div class="podium-entry podium-3">
        ðŸ¥‰ ${top3 ? top3[0] : "-"}
        <span class="percent">${top3 ? percent(top3[1]) + " picked 3rd" : ""}</span>
      </div>
    `;

  } catch (error) {
    podiumDiv.innerHTML = "<div class='loading'>Unable to load leaderboard.</div>";
    console.error(error);
  }

}

loadLeaderboard();

</script>

</body>
</html>


